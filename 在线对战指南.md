# 🌐 在线对战指南 - P2P 免费联机

现在游戏支持**完全免费的在线对战**了！不需要服务器，网页版也能联机！

## 🎮 什么是在线对战？

**在线对战** 使用 WebRTC P2P（点对点）技术，让你和朋友直接连接对战。

### 与局域网对战的区别

| 特性 | 在线对战（P2P） | 局域网对战 |
|------|----------------|-----------|
| 网络要求 | 有网就行 | 必须同一 WiFi |
| 服务器 | 不需要 | 需要 server.js |
| 距离限制 | 无限制（全球） | 局域网内 |
| 延迟 | 取决于网络 | 非常低 |
| 网页版 | ✅ 支持 | ❌ 不支持 |
| 费用 | 完全免费 | 免费 |

## 🚀 快速开始

### 方法 1：本地玩（测试）

1. **启动游戏**
   ```bash
   npm run dev
   ```

2. **打开两个浏览器窗口**
   - 窗口 1：http://localhost:5173
   - 窗口 2：http://localhost:5173（无痕模式）

3. **创建房间**
   - 窗口 1：点击"在线对战" → "创建房间"
   - 复制显示的房间 ID（如：abc123）

4. **加入房间**
   - 窗口 2：点击"在线对战" → 输入房间 ID → "加入房间"

5. **开始游戏**
   - 窗口 1：点击"准备开始"
   - 游戏自动开始！

### 方法 2：和朋友在线玩（推荐）

#### 前提条件
- 游戏已部署到 GitHub Pages（网址：https://lxc-0813.github.io/cabin_game/）
- 或者两人都在本地运行游戏

#### 步骤

**玩家 A（房主）：**
1. 打开游戏网址
2. 点击 "在线对战"
3. 点击 "创建房间"
4. 把显示的房间 ID 发给朋友（如通过微信/QQ）

**玩家 B（加入者）：**
1. 打开游戏网址
2. 点击 "在线对战"
3. 输入朋友给的房间 ID
4. 点击 "加入房间"

**开始游戏：**
- 房主点击 "准备开始"
- 游戏自动开始！

## 🔍 工作原理

### P2P 技术

```
玩家 A → PeerJS 信令服务器 ← 玩家 B
   ↓        (建立连接)         ↓
   └─────── 直接 P2P 连接 ──────┘
```

1. **建立连接**
   - 使用免费的 PeerJS 云服务器交换连接信息
   - 这个过程叫"信令"（Signaling）

2. **直接通信**
   - 连接建立后，两个玩家直接通信
   - 不再需要中间服务器
   - 所有游戏数据点对点传输

### 为什么延迟可能更低？

- **局域网对战**：玩家 → 服务器 → 玩家（两跳）
- **在线对战（P2P）**：玩家 → 玩家（一跳，直连）

## 💡 使用技巧

### 房间 ID 说明

- 房间 ID 是随机生成的字符串
- 区分大小写（建议全大写）
- 只对当前会话有效
- 不保存，关闭页面后失效

### 复制房间 ID

- 点击房间 ID 下方的 "📋 点击复制" 按钮
- 或手动选中复制（Ctrl+C / Cmd+C）

### 分享方式

**推荐的分享方式：**
- 微信/QQ 直接发送
- Discord/Telegram
- 任何即时通讯工具

**不推荐：**
- 邮件（太慢）
- 公开平台（房间会被占用）

## ⚠️ 常见问题

### Q1: 连接超时/连接失败？

**可能原因：**
1. 网络防火墙阻止 WebRTC
2. 公司/学校网络限制
3. 房间 ID 输入错误

**解决方法：**
1. 检查房间 ID 是否正确（区分大小写）
2. 尝试换个网络（如手机热点）
3. 关闭 VPN（可能影响 P2P 连接）
4. 刷新页面重试

### Q2: 游戏延迟很高？

**优化建议：**
1. 关闭其他占用网络的程序（下载、视频）
2. 使用有线网络（而非 WiFi）
3. 选择网络环境好的时候玩
4. 如果延迟仍然高，可能是两个玩家距离太远

### Q3: 房间 ID 过期了？

**解决：**
- 房间 ID 只在创建者在线时有效
- 如果房主关闭了页面，需要重新创建房间
- 这是 P2P 的特性，无法避免

### Q4: 可以多人对战吗？

**目前不支持**
- 当前设计是 1v1 对战
- P2P 连接限制为 2 人
- 未来可能支持观战功能

### Q5: 网页版和本地版能互联吗？

**可以！**
- 一个人用网页版（GitHub Pages）
- 另一个人本地运行（npm run dev）
- 完全兼容，都能连接

### Q6: 为什么比局域网对战简单？

**因为：**
- 不需要查找 IP 地址
- 不需要配置防火墙（通常）
- 不需要运行服务器
- 只需要一个简单的房间 ID

## 🔒 隐私和安全

### 数据传输

- ✅ 点对点加密（WebRTC 内置）
- ✅ 数据不经过第三方服务器
- ✅ 只有房间 ID 通过信令服务器

### 安全建议

- 不要在公开场合分享房间 ID
- 只和信任的朋友分享
- 游戏结束后房间自动失效

## 📊 技术对比

### 三种联机模式

| 模式 | 技术 | 适用场景 |
|------|------|---------|
| 单机对战 | 本地 AI | 练习、单人玩 |
| 局域网对战 | Socket.io | 同一 WiFi，最低延迟 |
| 在线对战 | WebRTC P2P | 互联网，网页版 |

### 性能数据（参考）

| 场景 | 局域网对战 | 在线对战（P2P） |
|------|-----------|----------------|
| 同一城市 | ~5-10ms | ~10-30ms |
| 不同城市 | N/A | ~30-80ms |
| 跨国 | N/A | ~80-200ms |

## 🎯 最佳实践

### 推荐配置

**本地游戏：**
- 启动游戏：`npm run dev`
- 使用浏览器：Chrome / Edge
- 开两个窗口测试

**在线游戏：**
- 部署到 GitHub Pages
- 分享链接给朋友
- 使用现代浏览器

### 浏览器兼容性

| 浏览器 | 支持情况 |
|--------|---------|
| Chrome | ✅ 完美支持 |
| Edge | ✅ 完美支持 |
| Firefox | ✅ 支持 |
| Safari | ⚠️ 部分支持 |
| 手机浏览器 | ⚠️ 功能有限 |

## 🚀 高级功能（未来）

计划中的功能：
- [ ] 观战模式
- [ ] 语音聊天
- [ ] 回放录制
- [ ] 好友系统
- [ ] 排行榜

## 💬 反馈建议

如果你遇到问题或有建议：
1. 在 GitHub 提 Issue
2. 描述问题：网络环境、浏览器版本、错误信息
3. 附上截图会更好

---

## 🎉 快速开始命令

**本地测试：**
```bash
npm run dev
# 打开两个浏览器窗口
# 一个创建房间，一个加入
```

**在线玩：**
```
访问：https://lxc-0813.github.io/cabin_game/
点击"在线对战"
和朋友分享房间 ID
```

**就这么简单！** 🎮

祝你玩得开心！有任何问题随时查看这个文档。⚔️
